# Maintainer: Piotr Gorski <lucjan.lucjanov@gmail.com>
# Contributor: Sergej Pupykin <arch+pub@sergej.pp.ru>
# Contributor: Alexey D. <lq07829icatm@rambler.ru>

pkgbase=psi-plus-plugins-git
pkgname=('psi-plus-plugins-git' 'psi-plus-plugins-dev-git')
pkgver=1.3.340.1.g2eff81db
pkgrel=1
pkgdesc="Additional plugins for Psi+ (built with Qt 5.x)"
arch=('x86_64')
url="https://psi-plus.com"
license=('GPL2')
depends=('qt5-base' 'qt5-multimedia' 'psi-plus-git' 'qt5-webengine')
conflicts=('psi-plus-plugins' 'psi-plus-plugins-qt5-git')
provides=("psi-plus-plugins=$pkgver" "psi-plus-plugins-qt5-git=$pkgver")
makedepends=('libotr' 'tidyhtml' 'libsignal-protocol-c')
optdepends=('libotr: for OTR plugin'
            'tidyhtml: for OTR plugin')
source=('git://github.com/psi-plus/psi-plus-snapshots')
md5sums=('SKIP')

pkgver() {
  cd psi-plus-snapshots
  git describe --long --tags | sed 's/^v//;s/-/./g'
}            
    
build() {
  cd psi-plus-snapshots
  cmake -DCMAKE_INSTALL_PREFIX=/usr -DONLY_PLUGINS=ON -DBUILD_DEV_PLUGINS=ON 
  make
}

package_psi-plus-plugins-git() {
  cd psi-plus-snapshots

  make DESTDIR="$pkgdir" install
  # split plugins
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libbattleshipgameplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libomemoplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libripperccplugin.so
}

package_psi-plus-plugins-dev-git() {
  cd psi-plus-snapshots

  make DESTDIR="$pkgdir" install
  # split dev plugins
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libattentionplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libautoreplyplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libbirthdayreminderplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libchessplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libcleanerplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libclientswitcherplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libconferenceloggerplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libcontentdownloaderplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libenummessagesplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libextendedmenuplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libextendedoptionsplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libgnupgplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libgomokugameplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libhistorykeeperplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libhttpuploadplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libicqdieplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libimageplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libimagepreviewplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libjabberdiskplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libjuickplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libmessagefilterplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libotrplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libpepchangenotifyplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libqipxstatusesplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libscreenshotplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libskinsplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libstopspamplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libstoragenotesplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libtranslateplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libvideostatusplugin.so
  rm "${pkgdir}"/usr/lib/psi-plus/plugins/libwatcherplugin.so
}
