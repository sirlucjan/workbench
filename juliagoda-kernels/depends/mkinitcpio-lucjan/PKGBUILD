# Maintainer: Piotr Gorski <lucjan.lucjanov@gmail.com>
# Maintainer: Giancarlo Razzolini <grazzolini@archlinux.org>
# Maintainer: Dave Reisner <dreisner@archlinux.org>
# Maintainer: Thomas BÃ¤chler <thomas@archlinux.org>

pkgname=mkinitcpio-lucjan
_pkgname=mkinitcpio
pkgver=31
pkgrel=12
pkgdesc="Modular initramfs image creation utility"
arch=('any')
url='https://github.com/archlinux/mkinitcpio'
license=('GPL')
depends=('awk' 'mkinitcpio-busybox>=1.19.4-2' 'kmod' 'util-linux>=2.23' 'libarchive' 'coreutils'
         'bash' 'binutils' 'diffutils' 'findutils' 'grep' 'filesystem>=2011.10-1' 'zstd' 'systemd')
makedepends=('asciidoc')
optdepends=('gzip: Use gzip compression for the initramfs image'
            'xz: Use lzma or xz compression for the initramfs image'
            'bzip2: Use bzip2 compression for the initramfs image'
            'lzop: Use lzo compression for the initramfs image'
            'lz4: Use lz4 compression for the initramfs image'
            'mkinitcpio-nfs-utils: Support for root filesystem on NFS')
replaces=('mkinitcpio-zstd')
provides=('initramfs' 'initramfs-lucjan' 'initramfs-zstd' "mkinitcpio=$pkgver")
conflicts=('mkinitcpio')
backup=('etc/mkinitcpio.conf')
source=("https://sources.archlinux.org/other/$_pkgname/$_pkgname-$pkgver.tar.gz"{,.sig}
        '0001-Merge-mkinitcpio-libalpm-scripts-into-one.patch'
        '0002-functions-allow-tailing-for-custom-kernel-build-upon.patch'
        '0003-Fix-ability-to-manually-specify-uefistub.patch'
        '0004-Add-support-for-post-generation-hooks.patch'
        '0005-Allow-overriding-hooks.patch'
        '0006-mkinitcpio-add-VERSION_ID-to-EFISTUB.patch'
        '0007-functions-no-progress-for-zstd-decompression.patch'
        '0008-mkinitcpio-Support-etc-kernel-cmdline.d.patch'
        '0009-presets-when-using-_efi_image-make-_image-optional.patch'
        '0010-Revert-functions-no-progress-for-zstd-decompression.patch'
        '0011-add-zst-compressed-firmware-support-fpr-future-kerne.patch'
        '0012-add-real-symlink-support.patch'
        '0013-add-real-symlink-support.patch'
        '0014-add-MODULES_DECOMPRESS-switch.patch'
        '0015-fix-reproducibility-in-case-of-var-cache-is-included.patch'
        '0016-Good-idea-add-the-default-value.patch'
        '0017-mkinitcpio-improve-MODULES_DECOMPRESS.patch'
        '0018-Replace-check-with-rm-f.patch'
        '0019-Fix-typo-in-commit-reproducibility.patch'
        '0020-mkinitcpio-preserve-module-dir-by-the-kernel-remove-.patch'
        '0021-Typo-correction.patch'
        '0022-Revert-presets-when-using-_efi_image-make-_image-opt.patch'
        '0023-preset-Change-unified-image-generation-options.patch'
        '0024-fixed-missing-uefistub-detection.patch')
install=mkinitcpio.install
sha512sums=('4ef87c2e4f579b292c38f9c487e78b3b99f6db77909cab322e860e5ca70aca3747fcfc272e2e15c9a3605c924ab178057b8b23151f98debc5d96e65f3c0c49d5'
            'SKIP'
            '02cbe231971e8691342e6ff4ce9133fe9e18bd87c44308103d13886b9cae1795f6eb20e47071de0bdb10a37c49571629670fcb8d9defb7974f1f9f6dd1dfa07d'
            'eccbf7df3d39aa627a48a684586e8f23f09628e7b743e36098055e43d41a21f80d7447038c0a037ed3d62684428e07532ed603e9e7d52f71e55872cfbaed7fcf'
            'a1ec544a19abd1e1ec53a82347fc576f9d1a34efd10e4db8bc06db0684979b9122e48fddd6a44466d05cb9af7b4afe97ddbd6ffac661d89a4ebb893b5ed72b34'
            '30fe51868c3494af9779a6c099f9f8d9a46def76f88530acf5096ea6323eeddae8ce8af0b96df2cb03affc624ec0c875cdf6e83749d43a27a6b04a81b2f95645'
            '2b2bf894e5a008d50e0bc7463bc32536768cfafa9f21189d4ebc219ec2a2cbae0bf677601483682372667545a9080dd3d8163be49a2ef9dc2c48f3300e1373f6'
            '9cd4f04cda01a3049a54977aa3e427a4abbc2c9852158c01d090efad5ae153058f1a456adfcbf0bf5a08983f9409f32d9fc3f410fc1dbdc5d708981abf6dac10'
            '11828db145461026e058cfe0c95af55f6d16188d98a97947cf1fe1f5dca051162ff03224f17f2238c83cdb750a24516d23a57cfb213f84226f8dfc0a6c80f095'
            '8a3268c9aae17890767834457f56bd6f9a6ff4b0d8aaead8d158713f79af5c44c95aea065ba5b9888351f856ec20155ce8fdbaf335ce841ccac68d7a1887a015'
            '572d5f8e0af43eb013baa7da47e6ea91b05d04a114b62c7291a3bb9e83336d012647854db297dc36b56cbbaebebb406ea8241262c09ef5b02bd80177f5a1767c'
            '798bccb517faa09d3bb9ddc002f086a5bfa6eac6cafea84ad991e1ab5377a3d6b570ceb512fa7416265852caff77b4e66c2be9f957b384fcd062c9d2d52c3665'
            'b21f25c25173cb63abb8467fbbbf3821d0d37bebc1d0f17e31bf28ce8fcebd015ba49feebfd96fe85363c5d282b7cc4763b290ed96c3740c6da2199986de5efc'
            '9de16f7aa47a8cf84beccab5c77c52f2ad63dfecc57de6fc667ada06df38cfd764bc72c69ad6a6e4885c8c03f61856b64d313aac943b78484f11fa97291ef387'
            '5cff56200a2b14544f3999c7cfacbfe5027ebb44dbc5fb984502dc544c7bef0e13532c7ebe33e8e2fdbe85c5a80666e0ea7197bf1b11b0a8d8e0ae77342d4947'
            'e0479a1732155e13d171f8646710f621d3d4fc4341a3dd965d6f2922b2482c770d4fa42868e567dd0b8edbe5d019220935dd38f3b4d413888fe27b6e6509ad07'
            'bea41aa84b89af4763bf0f4830327aadff377b1dd04bcfda3fcd09ae46f6314eca0611bc9616da889883455a68b603adeaaa8a91c8e31a09cf20dacbc6cd583c'
            '720bae9ba6c78c394c78d301cf2cb8cd2a7d7197425f3f41153e1490d07bb3070ac056ce10d07f1d2ce483c74fcf02d31d125bf1ca4c6f31836c01c0f59b4ce6'
            'c191825a05bc6311bd783eed1085ce10c0457d2096ee935ac2a261b24171cfdcf86b8eef242a68645e6e60b973a1fd6d1939a777df1f26fab2f6cc3d0db452d4'
            'ff858adf77d977907b065859a5e8397ac05c47b6cc9d27e6a98ab04101c0d2ce6c05cd5c4555dbea297fb076ec1f04ebf0b3e4f3053381fb8728a435a9ec2ea7'
            '8f0b0701ce78e113603b4bf70bcb0938e3a485637909cae8bba18f2e867e5c775c68fb2b8c4000d588c17ae937a0f3f13d32617dc52ee050ee21fc9b726d9592'
            '8bfbda42815854567448b2bfe91623f2b5404bbbf944edad140a7e5f337462b3719702c217b32187f2ed0087d91557bb32e9c8fbdf015cd7fe59e1b39c04a808'
            '5cdacf6cf5bb25fbeba5f05a38bba1b10eba8ccbbf0b6592f132d02934d6e17a310d6b9a91d07e2ed16d8309a9c31eaab8b965e791901cf3ae0423c6c83b34b1'
            'd5bcaa419da6381ec9ef7750fe9c513fb897deb73430a0cd368fb668e874ad8e6f380900b8a5fc96aefcafba45a6b622770d82db6a9cffe5cd9cc66a31faca0c'
            '32688aa29f4c4c0d6707da2b5b5dd6d743996dc252b45124e4788a8b56821fc2bf945bcd72fcb34dc0b43f25b3773cdadd116757b94a4feae575a16b7e72d78c'
            'a56c61fd55a9867cbb2c32c9f3c7c6fa54e594883c98be466cdcb521dce946af32f3e0aa777e358beb22cc83d1f39bff620891083197df4bd52f7c39dc51dae6')
b2sums=('0113e288906e3b5fa485c29c00e7df60d85addd96718c45531031a686f18c739fa18303b6cac374d35b85edb7b663e221c8dc9158dff08c75858a4ed4dd154bf'
        'SKIP'
        '24e6f5b0b1212f5413485eaa1cc632a030918799f144c3c93504562c902f49294f17035550ca4124b6498d45b5b92e1d707d2f4da71457c0fd124710a46d5855'
        '7d317542bd8d7fcbb86de5813a844e5522c7f5af1b787b6686404270f20a3bf6772a59c3d9806538f2b4900ba24145aa8ae64070285c9031fc3ac64979c09d60'
        '9f4bf45331b5983e87510b75983408c8ee74448262589ff4c08a9a5e15032528d96713e4c1ee0b356f13f9ff95acf12ed0747d029fc7687c9bdc53b945a899d5'
        'b3887401b1de6a698cf29748c702a279ccfc6fe5ea6e630c02413d950fe05277563e1ba006ae80a36b46cb73ce2c2234aa41babe8dbb7fde99270596f144a512'
        'f98dd5ee4b1b5e94225faea044402021daee927ddb8530f9369aa19438ac2d34e78490819ff3800730b45ab61291f2ade375293f47c0a533c91c87b03b83b08f'
        '64603bb56b41a4e4e6c139b3652eb959ea896915ff1a153d29e8d6ad5ecb62a0fb76d1306bf0ccdcfd8d650d92601ec306338f34183fe6b92ccba664d0db35ba'
        'bac4f37132cd92d1559caabf6b14914ff485d4ddaa01fa8a53004308c7644d147db04162e88f385821fc91246adf255eb288dbbda9b33e3c0e1d4a637e54c03f'
        'afd6a887714a3bd7e811c68574bc2c140a55285c9888d3610efc7e9d172ddc09c0b2088d975ad259afe3dc33da2e35f4b69be0383b4843bd8f33a8b60e8eb16d'
        '5bb204757f1b3eca6742abd47afc317b5d96c2a7a7c0d27d90045d4efed59444cdf0c1ddc8385edea44d3df68735aa02145b80025b12da9f661946e7429c3193'
        'b17ba922d85751ef72b51d7fb6b6862324eddfc28ed0501e786f4c7c494238177be2de73244366373ab09e7a4f29de3d3a24d7a8cc2cae298523e65f54b79a69'
        '2a9cd951e941cd2d749b716f527c85846ad29ed87e8b6ba4aa463994a5df83eb31a9553b2d7e6fd9b6f880864b9dffddd29ca6d234a56852346b536cd9ada424'
        '5fbdfa7f11888398e10e202b1399b6534019fc99df859a79ca6f8cf01442f9c8c19574402aaad143956074cbf229c3cf6f1853bc57a9bbef4e8309383edf7fd7'
        '596ba040dabd1bc37ef99b29dd2748a55e17f976212fbd08dee4d86ff61d547f743cd7b4471918634dda6f0b28e0dacaaa653bf77f0a0887f34431ed00f5b2ed'
        'c7b69533081c5ea37b39c6f5d0efe8c77998d747994abf5f164217f2bdb07e5637938e404d19e5b6b02c6e62b6c4f5edf896051ec8ae575c05b20fb8b3c3f96e'
        '86ca7c98f315f369a4811c81b6e06f06e325082ef0d6d0337435fb1a9bba4862b483e348a6cf269d766390eed6ef785e4065313b835329fd324f13e038b5ac30'
        'ea7833473fb905903047420c2357ec8fbd7c1d26c3afb40a76ffd0ac6ce95d96fc4c8610aa04a8fade0610fcc3840014cc1842f8de9b69f9ad4b369d31464cfa'
        '2e86290710c1eb0d727a8739e38a173c6b715535ce56fc9cf3584550cc8f4842cf54f3340ef1858e3939a3e1e636599a0b83a65f68ebd4d24b1e1d14ef38382e'
        'fbc37c15d2762474ab690230250903b8287c80e31b334a22e15fdc2b832c04c9e0fc2137d443ee0e11375e66de8a32118f9463bf86300f44274efc839df722c1'
        'a9e8f7ed9dd2717be09dd6e1c87ece0b4b7c3b24364f89a34318185bbf3eff7adb292688ce731654b8fab4a1fdd64c2a4b10163f6b8d82abd52a544cb02acae7'
        '3d461cd891e70aa830624dd97de950d441d7881c553148a7008b3117d61514fe19582c78b0d6ccf6422f5f858279badae0d1226c9bf2f896ecc0c0a469a38ece'
        '75aa49786ad93d583c8e0290c5730c5bf280f43a103a75eb2a9f5b9ff7453b9c0b05ca1b9db381ea81d6335cd13d4b9b410f7849283c36fe061f6df2e2418ca9'
        '8b7e2dfb01c5ebc2709cec79141b8d86d28531dcb603a2218e91e9551f9b4baf11ea4eefd07d367bac47157900dbd4f2bf1609f38f0bef25c47e3d1fa86a382d'
        'f063dd9c5e535ea7caea44c8f7c25591ac01a35bedea1291156fe27250333232f194fd00130c96626898bbfeef8a506c3a9a906968f96217a011adebc832e12c'
        'f6936773232f71b8f7d11bc8d7cd14306e2e28b3c9ab5a227d2dcc043c1382ea29106961e75233550bb87284d7223bcb388a4990975683837b05b2f4f7adf93e')
validpgpkeys=('ECCAC84C1BA08A6CC8E63FBBF22FB1D78A77AEAB')    # Giancarlo Razzolini

prepare() {
 cd $_pkgname-$pkgver

 local src
  for src in "${source[@]}"; do
    src="${src%%::*}"
    src="${src##*/}"
    [[ $src = *.patch ]] || continue
    echo "Applying patch $src..."
    patch -Np1 < "../$src"
  done
}

check() {
  make -C "$_pkgname-$pkgver" check
}

package() {
  make -C "$_pkgname-$pkgver" DESTDIR="$pkgdir" install
}
