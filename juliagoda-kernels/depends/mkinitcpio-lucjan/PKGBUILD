# Maintainer: Piotr Gorski <lucjan.lucjanov@gmail.com>
# Maintainer: Giancarlo Razzolini <grazzolini@archlinux.org>
# Maintainer: Dave Reisner <dreisner@archlinux.org>
# Maintainer: Thomas BÃ¤chler <thomas@archlinux.org>

pkgname=mkinitcpio-lucjan
_pkgname=mkinitcpio
pkgver=31
pkgrel=11
pkgdesc="Modular initramfs image creation utility"
arch=('any')
url='https://github.com/archlinux/mkinitcpio'
license=('GPL')
depends=('awk' 'mkinitcpio-busybox>=1.19.4-2' 'kmod' 'util-linux>=2.23' 'libarchive' 'coreutils'
         'bash' 'binutils' 'diffutils' 'findutils' 'grep' 'filesystem>=2011.10-1' 'zstd' 'systemd')
makedepends=('asciidoc')
optdepends=('gzip: Use gzip compression for the initramfs image'
            'xz: Use lzma or xz compression for the initramfs image'
            'bzip2: Use bzip2 compression for the initramfs image'
            'lzop: Use lzo compression for the initramfs image'
            'lz4: Use lz4 compression for the initramfs image'
            'mkinitcpio-nfs-utils: Support for root filesystem on NFS')
replaces=('mkinitcpio-zstd')
provides=('initramfs' 'initramfs-lucjan' 'initramfs-zstd' "mkinitcpio=$pkgver")
conflicts=('mkinitcpio')
backup=('etc/mkinitcpio.conf')
source=("https://sources.archlinux.org/other/$_pkgname/$_pkgname-$pkgver.tar.gz"{,.sig}
        '0001-Merge-mkinitcpio-libalpm-scripts-into-one.patch'
        '0002-functions-allow-tailing-for-custom-kernel-build-upon.patch'
        '0003-Fix-ability-to-manually-specify-uefistub.patch'
        '0004-Add-support-for-post-generation-hooks.patch'
        '0005-Allow-overriding-hooks.patch'
        '0006-mkinitcpio-add-VERSION_ID-to-EFISTUB.patch'
        '0007-functions-no-progress-for-zstd-decompression.patch'
        '0008-mkinitcpio-Support-etc-kernel-cmdline.d.patch'
        '0009-presets-when-using-_efi_image-make-_image-optional.patch'
        '0010-Revert-functions-no-progress-for-zstd-decompression.patch'
        '0011-add-zst-compressed-firmware-support-fpr-future-kerne.patch'
        '0012-add-real-symlink-support.patch'
        '0013-add-real-symlink-support.patch'
        '0014-add-MODULES_DECOMPRESS-switch.patch'
        '0015-fix-reproducibility-in-case-of-var-cache-is-included.patch'
        '0016-Good-idea-add-the-default-value.patch'
        '0017-mkinitcpio-improve-MODULES_DECOMPRESS.patch'
        '0018-Replace-check-with-rm-f.patch'
        '0019-Fix-typo-in-commit-reproducibility.patch'
        '0020-mkinitcpio-preserve-module-dir-by-the-kernel-remove-.patch'
        '0021-Typo-correction.patch'
        '0022-Revert-presets-when-using-_efi_image-make-_image-opt.patch'
        '0023-preset-Change-unified-image-generation-options.patch')
install=mkinitcpio.install
sha512sums=('4ef87c2e4f579b292c38f9c487e78b3b99f6db77909cab322e860e5ca70aca3747fcfc272e2e15c9a3605c924ab178057b8b23151f98debc5d96e65f3c0c49d5'
            'SKIP'
            '1d5b8466acb4ee2dccb5a388934d32abb898f0c54ed4ce6d610e3917905d4d8af59ca2951bc8a3d9c4808fba7806d5f1dbaf91279d6b90595c42287f25496ae9'
            'aa83e627718a4956db04d2419ca4536c14b2e1ce8c5cdf8eb69850e9bc8dcf9fbb3fe28486f77f7d97ddbdee9f5f2edd5ba96f4677062fd73cf6598e64ca297c'
            '3a35a913e927405365139e9f6f64d5a066d32052727e407047e1ecf5e6e138a5c17980465820a3b02830b6857395bd76c4d93e028b2ae1b64f24420a916d0f57'
            '1b301b4ced753ebfa0e7435eaa24956f3fa12e5c1ebb1aead84fc9139fd14a94faae8440117d4339071d492c7407f46a90d82fbed2d60a99efdee2106f09ed0e'
            '75e31da45a46559d13d9851cbd56f48f89dcb0860feda008e252d6d02e1817b11109a2128c043ed25b0cdfd99113f4f0544bdbb8652990dd952aa0ab2b03a6cd'
            '3762d044e9ffcb49c18df61b6c6ce96786800e0c0e09e6149e8f8eeef072911e2b7472a1fb3fb1cdd515035a89664ea10ca293767707d21835d7440215b335ca'
            '8c18ed5df34ce615f5429a339b5ef56c392034252617aa9f7153854e9a6e490bb6c5276dd102aa04c414532450646c2dbe5f39b6bda7af230a5fedc0a3aa47e7'
            '9c80215531ad48d98bf03e24585ee2d72643fb2c7e6a8db23ab24bd67e4d7b5ae3fbdba43bfe8cff1a2824d197083d3e9eb3bf244b36e6ba02b26229b69bcba3'
            '7991797fce4c2e54f134f56c89247169553662c0b8e570dd3da699a1785a6b93acc5f579b1e85dbc20423bff5009100b5cd73403d43692636261f03549230a99'
            '976de044aab8841b5d9bd35c35f21ee5532ed42bd169477a0eae8a3958a07d5012cda7ea09ee9f9d7dcf98ec0d68e3204dc03e0094bbe19a110a80d5b6fb742e'
            'b750f8896463fb0adfab0f7db4caf3a6dfdb8deb2cb1b6d5387bea8e5f1706016d18c255d810d875b2ea0ff128ede39dae09f29a949aa89187007130eedcdf2f'
            'da1147ee388194e35a67fb4a96f8132017b50b5319f3c1e440275349dbe0ef2fe5482371d0ec7a89c5b3a5d3219ab8eca18890f5ff741d663b63d2014de796ff'
            '33acb4d2d6f37c17bad9b6163c8d0bd39da5e140342f6c3b714056648c36a729d950b90be4452a901337c13f7cc6b75d1fd03e4efe9ab1d8d41b92d3270430ba'
            '63e2f087ad8ae9e542bb222e1d781ec68d0ce51a5c78a0e97858cca60ca7e51d2d7a572a820556c9b6725df9d5399316d3218cd76ba3ee11189746d33e7a4846'
            '77c81b4f476040313377375150956390743f8ff553073fdf050d9fcd80a6415ec7e493587a1a5c6f02c1bf9fd57e76fa1a89fa33bcfe70f9f830782ac455b7f9'
            '9565c0bd1f721f7d987b65c1ff6e19e85b8a55343d5c4c8f19bcc412fca6ebd185410725d5d1cd074fe2d1fd07c0165a3bdd82e798a811369810eea412f36a1e'
            'cfecf6a96165da1a6a80734b4d72f38bc32128e85eb3ba4b09c246a6c8adb44752c23f4d29f5d6b71e231a33bc312d70971303715229704b3ca75ca335654fb8'
            '4dde10bd02147946d80d32f798e52eb7ad24398aada0b4f21c0558b695db701b203bb11e83cbd1cb05eb43691b7368631f5168084d7c9d9f7ec45d0faa32399a'
            'ea09fdad45ac347d80647b00a9b00e238ac81c5f29c5482a1ec59f1e07eb0365baabeb9428d4a82ba379ded08974360b2e9663797e1353919ee8811843a93360'
            '6e0742488efc11156d430089289052504998bfec6f8ae8c5bae23abde6a932a9b6c8b963808be76022267d7aba711729258292e469dfc64be67a324188d2111e'
            '6cb9df55aed9fd786edbe503392d98df1d02e72c2dd16e885f2ed92ff3c378ab92fe5dbbf57f77bd85ad2a3a5a1c9f385928156bb1feabfa26243f5394a2dad8'
            '65c4fe2998b5d8ce0432eda0efe733c6e24986f27d87645d75feb6e955817a26c1efde93b39081d1d573b191e719670944d82a834bdddf891b7e1a3ebe014195'
            '5d43ee72e549eecc39e2cc689ae4a294916d5f12f84fb96b66765be3948b9c21501803850c8d2070b2874fa42c192837243f1f0988466b87ac0d8512c8fb693e')
b2sums=('0113e288906e3b5fa485c29c00e7df60d85addd96718c45531031a686f18c739fa18303b6cac374d35b85edb7b663e221c8dc9158dff08c75858a4ed4dd154bf'
        'SKIP'
        'c0acce163d70b4d72043037c47050119c7a950e769b9929dde1c97f7015b0fb8310a18c9353b19a37de1794b93d4a6d78414ecc596c9d5fbb7c5f6eb2520b3db'
        '7220bf37d993a13695e241757bb309614555f5e8649a4bc5bfbe7a601037fe2a7de762d0a9aba2a16621ce971bc99857de3843cb39330bbb1296edebb9207c12'
        'a65b13dea91cd37ffb4132af0d4572b74db630ec55d34dcdc18b5f086ea81ac105a5caf0944bd889e93b3ccf4d91ce3e1c2e5d5ffc047ca5f4a31636fdb62c22'
        '845b318c0adb277c87684e2b4b611f3924b5f848914801d4734465a2120460be9ed1bd958e0183fbf802b173891bc89a028ef3ea877512f575532bf7d3275121'
        '51b15cbf4624f2e0d30029323c55db3cf543af82cda932e48d0e0588320f9e8413f6c96119fdf1f59df6f0b75009b2dd9647e04281a75b4c43170e8627fb9a69'
        '4007fabac3bf6f9a141c4bbd4c07604f18df1ff0941738b206dc69c10969f89fe6ecc4aad447dcfdc01129de95190b33ddea33c902a5d5d4ac634768902e9d70'
        '28475ce9eccdebb3646d15a337e423445d2b98da47ae6d5da8c706326234a8f0205300e89f0a8d5179cb6a8067d0efb2b30788f26eb106d42df693a63987c380'
        '0cea2949c259bed3821c6d7ed5ccd4033ff4d138b1ad888fa10f67053727df7498cd4900a71da8761445b7edd2c20a49bead527f4e1f529184496ff314c02955'
        '50c12e74bc28649eb264c998fc5b75757f1891e8df0da65347ae7e2ac003d755097f4891581c9ef7355923268aac31e980b922750a5bebf9794d5ee5b2f1ce6c'
        '6960970c7ad0c7d8cf048ab2f2fd0861349dddcab98eb1048a41f8bee7287cbd62c3400a9a7a63bfe2600ada2168d0e0cbb3b1d901d950db936d7b377e234f4c'
        '96e82dcc31f7f5cfbccd815d2427f329539a9c41366595468b4ab0671918fe81fd9d5a159ab9d17b831b0bc031a3e3bff438121f955c65297decc72719e5670d'
        '133c073db72d44a8512f789119d08b4b748a8c14435ceb1f484d490a199576a42d1d0b4f83097299eb369e3fa3aab4df630295a87813d750116e4394efd0c126'
        '211b95b5802c9ffcc23ee4fed7ccee6ce8fb0b99320275ed08ebe6e343f2ac572fa1665f023563785544f18057fabe3d347fa20683f0caf466c65ae489b33cab'
        'd31d9001d7651f1c36a54d0587808d6e6f35f2edd8b8149d691c85a48d1a525835992f1603ba1abbf6605314157ae21ac662c18d1b19c4fa5ee139760b4899fa'
        'e46d8a2ec34ba9378d90a8b8dd9abf26bcd9bab6c69c2d6f72fcabcaf4349ba7e328fd3f6e80f3c766f9637d14a2e2d688bc9843a28b7b58d596eb145d705bdf'
        '2f830bcfe1ede455719e30c04911309cbd836f7a3d669ce72f645b666fb4834f73b2024c14b7ce216a3bf1deeacada5184794a56e47d760ff5b4671470308568'
        '984b3f7baa16a6c85e89e1a0f176be08f60578ccf42e1519fe3e585eaf04baeb7aa04b1f79cf943f94eda7d182fd0cc20238a4a6d7070de83a56b1b1adc990ce'
        '142b3619372a876852848c2b28e653623bd878863198d88ea1f03c7414c10049e2a3c5fa4682afd6be0b830287d1c7a16cc5d03a13461ca053a5654040ccc12f'
        'aadfc6ca5a210e099b9dc2c4a75cc454459b9fa796a7014aecf85da9b862a91549be3867c5f14bf1534aeb09057b4a829b479c37994d6dbf79c048fd11ba3162'
        'cdf9da20fe954370f8f203766ff80ac6f10c7a9ca70333c94d403b1c3bc0f5e1e9a2cd99ace854654a47809d5c08a5cc6d53ecff88ed112cba8eb3b1ebb9e043'
        'c341e5624ae1f3c3eed610236f5da3f77274010d5bb73b55a51ec6c24ed9a0856d3cf8422d7e31981c99b2d1a4801adb49fc84e579251ace29d32a46381b407d'
        'f3d98b752b7797ce559d937b1ff923afedf8e81e352520a1c36a73f5aa49c4cbad1dc3fd89f1e42e45a019404458d003894b5d9507068db0592c61315d0cc4f1'
        '38520bb850dcab96e89f585a92b9bd43029abf0fa53629efdb9e06643d118a90dfd9acf7d880a4776575153a80ab49ecb8d05f07afe74f61208dd927d29b3bd8')
validpgpkeys=('ECCAC84C1BA08A6CC8E63FBBF22FB1D78A77AEAB')    # Giancarlo Razzolini

prepare() {
 cd $_pkgname-$pkgver

 local src
  for src in "${source[@]}"; do
    src="${src%%::*}"
    src="${src##*/}"
    [[ $src = *.patch ]] || continue
    echo "Applying patch $src..."
    patch -Np1 < "../$src"
  done
}

check() {
  make -C "$_pkgname-$pkgver" check
}

package() {
  make -C "$_pkgname-$pkgver" DESTDIR="$pkgdir" install
}
